
<div class="container col- mx-auto">
  <div lass="row">
    <p class="display-4">Classes statistic</p>
    <div class="container col-">
    </div>
        <div class="btn-toolbar mb-2 mb-md-0">
          <div class="btn-group mr-2">
            <!-- Put create class button -->
            <a href="{{ url_for('professor_bp.professor') }}"><button class="btn btn-info btn-lg">Create Class</button></a>
          </div>
        </div>
  </div>
  <div class="row">
    <!-- Put Chart -->
    <div class="col">
      
      <!-- Put chart here -->
      <canvas id="myChart"></canvas>

    </div>

    <!-- Put table -->
    <div class="col">
      <!-- Put table -->
      <div class="table-responsive">
        <table id="classTable" class="table table-striped  table-hover table-sm" cellspacing="0" width="100%">
          <thead class="thead-dark lead">
            <!-- Table top rows -->
            <tr>
              <th scope="col">Class Name</th>
              <th scope="col">Class Code</th>
              <th scope="col">Category</th>
              <th scope="col">Options</th>
            </tr>
          </thead>
          <tbody>
            
            {% for row in data %}
            <tr>
              <form action="/analytics/check" method="GET">
                <th scope="row">{{row.className}}</th>
                <!-- Get class code into the form  -->
                <!-- The input cannot be disables -->
                <td >{{row.classCode}}<input type="hidden" id="classCode" name="ccode" value={{row.classCode}}></td> 
                <td>
                  <div class="form-group">
                    <select name="category" id="category" class="form-control" required>
                      {% for category in categoryData %}
                      {% if row.classCode == category.classCode %}
                      <option>{{category.category}}</option>
                      {% endif %}
                      {% endfor %}
                    </select>
                  </div>
                  <button name="check" id="check" href="{{ url_for('auth_bp.login') }}" class="btn btn-block btn-dark" type="submit">Check</button>
                </td>
                <td>
                  <table style="border: none;">
                    <td style="border: none;">
                      <form action="/analytics/" method="GET">
                        <a href="{{ url_for('analytics_bp.analytics', classCode=row.classCode)}}" class="btn btn-outline-primary">View All Feedbacks</a>
                      </form>
                    </td>
                    <td style="border: none;">
                      <div class="form-group">
                        <a href="/professor/edit/{{row.entryId}}" class="btn btn-outline-success">Edit</a>
                      </div>
                    </td>
                    <td style="border: none;">
                      <button class="btn btn-outline-danger" id="delete" data-toggle="modal" classCode="{{row.classCode}}" data-id="{{row.entryId}}" data-target="#exampleModal">Delete</button>
                    </td>
                    
                   
                    <!-- Realtime data-->
                    <td style="border: none;">
                      <a href="{{url_for('professor_bp.get_chart', classCode=row.classCode)}}"class="btn btn-outline-warning">Realtime</a>
                    </td>
                    
                    <!-- Modal -->
                    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                      <div class="modal-dialog" role="document">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Delete Class {{row.classCode}}</h5>
                            
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                              <span aria-hidden="true">&times;</span>
                            </button>
                          </div>
                          <div class="modal-body">
                            Are you sure you want to delete this class?
                          </div>
                          <div class="modal-footer">
                            <a class="btn btn-danger" href="/professor/delete/{{row.entryId}}/{{row.classCode}}">Delete</a>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                          </div>
                        </div>
                      </div>
                    </div>
                 </table>
                </td>
              </form>
            </tr>
            <!-- Modal -->
            <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 id="title" class="modal-title" id="exampleModalLabel"></h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    Are you sure you want to delete this class?
                  </div>
                  <div class="modal-footer">
                    <a class="btn btn-danger" id="deleteClass" href="/professor/delete/{{row.entryId}}/{{row.classCode}}">Delete</a>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                  </div>
                </div>
              </div>
            </div>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
  

<!-- Draw bar chart -->
<script>
  //let intervalID = setInterval(get_catgeories_for_class,1000);
  
  function get_catgeories_for_class(classCode){
    $.getJSON('/chart-data/showCategories/554-DDDD',
            function(data){
                console.log(data);
            })
  };

  // Somehow loop over the length
  let myCategories = {{ present|tojson}};
  let wN = {{wN | tojson}};
  let numbers = []

  console.log(wN[1]);

  for(key in wN){
    numbers.push(wN[key]);
    console.log(wN[key]);
  }

  let ctx = document.getElementById('myChart').getContext('2d');
  var myChart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: myCategories,
        datasets: [
          { 
            label: 'Feedback count by category',
            data: numbers,
            backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)'
            ],
            borderColor: [
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)'
            ],
            borderWidth: 1
        }]
    },
    options: {
      labels: {
              // This more specific font property overrides the global property
              fontColor: 'black',
              defaultFontSize: 20
          },
          
      events: ['click'],
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero: true
                }
            }]
        }
    }
});
</script>

<script>
$('#classTable').dataTable( {
  "lengthMenu": [ 5, 10, 15, 20, 25 ]
} );
</script>

<script>
  // $('#myModal').on('shown.bs.modal', function () {
  // })
  // ON SELECTING ROW 
  $(document).on('click', '#delete', function () {
    //FINDING ELEMENTS OF ROWS AND STORING THEM IN VARIABLES 
    console.log($(this))
    var id = $(this).attr("data-id");
    var classCode = $(this).attr("classCode");
    console.log($(this).attr("data-id"))
    console.log($(this).attr("classCode"))
    var p = "";  
    p += "<p>Delete class " + classCode + " </p>"; 
    //CLEARING THE PREFILLED DATA 
    $("#title").empty(); 
    //WRITING THE DATA ON MODEL 
    $("#title").append(p); 
    document.getElementById("deleteClass").href = "/professor/delete/" +id+"/"+classCode;
  });
</script>